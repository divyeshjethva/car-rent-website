<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Shopping Cart</title>
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-5">
  <h2 class="mb-4">Your Shopping Cart</h2>
  
  <!-- Cart Table -->
  <div class="table-responsive shadow-sm">
    <table class="table align-middle">
      <thead class="table-dark">
        <tr>
          <th scope="col">Product</th>
          <th scope="col">Price</th>
          <th scope="col">Quantity</th>
          <th scope="col">Subtotal</th>
          <th scope="col">Remove</th>
        </tr>
      </thead>
      <tbody>
        {% for i in cart %}
        <tr>
            <td>
            <div class="d-flex align-items-center">
              <img src="{{i.car.cimage.url}}" height="70px" class="rounded me-3" alt="Product">
              <span>{{i.car.cname}}</span>
            </div>
        </td>
        <td>${{i.car.cprice}}</td>
        <td>
            <input type="number" class="form-control w-50" value="1" min="1">
          </td>
          <td>${{i.car.cprice}}</td>
          <td>
                <a href="{% url "deletecart" pk=i.pk %}">
                  <button class="btn btn-sm btn-danger">
                    <i class="bi bi-trash"></i>
                </button>
                </a>
            </td>
        </tr>
        {% endfor %}

      </tbody>
    </table>
  </div>

  <!-- Cart Summary -->
  <div class="row mt-4">
    <div class="col-md-4 offset-md-8">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Order Summary</h5>
          <div class="d-flex justify-content-between">
            <span>5% TAX</span>
            <strong>${{tax}}</strong>
          </div>
          <div class="d-flex justify-content-between">
            <span>price</span>
            <strong>${{net}}</strong>
          </div>
          <hr>
          <div class="d-flex justify-content-between">
            <span>Total:</span>
            <strong>${{total}}</strong>
          </div>
          <button class="btn btn-success w-100 mt-3" id="rzp-button1">Proceed to Checkout</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap JS -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
                    <script>
                        var options = {
                            "key": "rzp_test_3iCOPLbchUyIwQ", // Enter the Key ID generated from the Dashboard
                            "amount": "{{context.payment.amount}}",// Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
                            "currency": "INR",
                            "name": "CarBooking",
                            "description": "Test Payment", //This is a sample Order ID. Pass the id obtained in the response of Step 1
                            "handler": function (response){
                
                                window.location.href=`http://localhost:8000/sucess?razorpay_payment_id=${response.razorpay_payment_id}`
                
                                // alert(response.razorpay_payment_id);
                                // alert(response.razorpay_order_id);
                                
                            },
                            "theme": {
                                "color": "#94CA21"
                            }
                        };
                        var rzp1 = new Razorpay(options);
                        rzp1.on('payment.failed', function (response){
                                alert(response.error.code);
                                alert(response.error.description);
                                alert(response.error.source);
                                alert(response.error.step);
                                alert(response.error.reason);
                                alert(response.error.metadata.order_id);
                                alert(response.error.metadata.payment_id);
                        });
                        document.getElementById('rzp-button1').onclick = function(e){
                          rzp1.open();
                          e.preventDefault();
                        }
                    </script>

</body>
</html>
